<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-08-13 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140813" />
    <meta http-equiv="Content-Language" content="fr" />
    <title>Singleton Case - Getting Started !</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarEnabled">
          
    
    
            
    
        
    <a href="http://github.com/sydisnet/blog-samples/deltaspike-cdi-12">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support & Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="getting-started.html"  title="Getting Started !">Getting Started !</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation sur le projet <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Info Projet">Info Projet</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="index.html"  title="Bienvenue dans le projet">Bienvenue dans le projet</a>
</li>
                                  <li>      <a href="plugin-management.html"  title="Gestion des plugins">Gestion des plugins</a>
</li>
                                  <li>      <a href="distribution-management.html"  title="Gestion de la distribution">Gestion de la distribution</a>
</li>
                                  <li>      <a href="dependency-info.html"  title="Informations de dépendance">Informations de dépendance</a>
</li>
                                  <li>      <a href="source-repository.html"  title="Dépôt de sources">Dépôt de sources</a>
</li>
                                  <li>      <a href="mail-lists.html"  title="Listes de diffusion">Listes de diffusion</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Contrôle des livraisons">Contrôle des livraisons</a>
</li>
                                  <li>      <a href="integration.html"  title="Intégration continue">Intégration continue</a>
</li>
                                  <li>      <a href="plugins.html"  title="Plugins du projet">Plugins du projet</a>
</li>
                                  <li>      <a href="license.html"  title="Licence du projet">Licence du projet</a>
</li>
                                  <li>      <a href="team-list.html"  title="Membres de ce projet">Membres de ce projet</a>
</li>
                                  <li>      <a href="project-summary.html"  title="Résumé du projet">Résumé du projet</a>
</li>
                                  <li>      <a href="dependencies.html"  title="Dépendances">Dépendances</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Rapports Projet">Rapports Projet</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="xref-test/index.html"  title="Sources Xref des Tests">Sources Xref des Tests</a>
</li>
                                  <li>      <a href="xref/index.html"  title="Sources Xref">Sources Xref</a>
</li>
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                                  <li>      <a href="taglist.html"  title="Liste des tags">Liste des tags</a>
</li>
                                  <li>      <a href="jacoco/index.html"  title="JaCoCo Test">JaCoCo Test</a>
</li>
                                  <li>      <a href="cpd.html"  title="CPD">CPD</a>
</li>
                                  <li>      <a href="surefire-report.html"  title="Surefire Report">Surefire Report</a>
</li>
                                  <li>      <a href="jdepend-report.html"  title="JDepend">JDepend</a>
</li>
                                  <li>      <a href="checkstyle.html"  title="Checkstyle">Checkstyle</a>
</li>
                                  <li>      <a href="dashboard-report.html"  title="Tableau de Bord">Tableau de Bord</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Singleton Case</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Dernière publication: 2014-08-13
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0.0-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Support & Documentation</li>
                              
      <li class="active">
  
            <a href="#"><i class="none"></i>Getting Started !</a>
          </li>
                              <li class="nav-header">Documentation sur le projet</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="project-info.html" title="Info Projet">
          <i class="icon-chevron-right"></i>
        Info Projet</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="project-reports.html" title="Rapports Projet">
          <i class="icon-chevron-right"></i>
        Rapports Projet</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://github.com/sydisnet/blog-samples/" data-size="tall" ></div>

                   <div class="clear"></div>
                   
        
        
        
    <iframe src="http://www.facebook.com/plugins/like.php?href=https://github.com/sydisnet/blog-samples/&send=false&layout=box_count&show-faces=false&action=like&colorscheme=light"
        scrolling="no" frameborder="0"
        style="border:none; width:48px; height:63px; margin-top: 10px;" ></iframe>
               <div class="clear"></div>
               
        
        
        <div id="twitter">
    
    <a href="https://twitter.com/sydisnet" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="fr">Follow sydisnet</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        </div>
                   <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Produit par Maven" class="poweredBy">
        <img class="builtBy" alt="Produit par Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Getting Started !</h1>
<p>Si vous utilisez <b>CDI</b> a.k.a. <b>Contexts and Dependency Injection for the Java EE Platform</b>, peut-&#xea;tre utilisez-vous aussi <b>CDI</b> dans un contexte <i>Java SE</i><i>, i.e. en dehors de tout serveur d&#x2019;application </i><i>Java EE</i>*.</p>
<p>Le 8 avril 2014 a vu le jour d&#x2019;une maintenance release pour CDI &#xe0; savoir la version <b>1.2</b>.</p>
<p>Cette version n&#x2019;est actuellement pas fournie par un serveur d&#x2019;application quelconque, la sp&#xe9;cification <b>Java EE 7</b> s&#x2019;appuyant sur <b>CDI 1.1</b> et Java EE 8 devrait quant-&#xe0; elle s&#x2019;appuyer sur <b>CDI 2.0</b>.</p>
<div class="section">
<h2>CDI 1.2<a name="CDI_1.2"></a></h2>
<p>La documentation de cette nouvelle mouture est disponible &#xe0; <b><a class="externalLink" href="http://docs.jboss.org/cdi/spec/1.2/cdi-spec.html" target="_blank">l&#x2019;URL suivante</a></b> sur le site de <b>JBoss</b>.</p>
<p>L&#x2019;objectif premier de cette version est de clarifier certains &#xe9;l&#xe9;ments de la sp&#xe9;cification comme le fonctionnement des &#xe9;v&#xe9;nements li&#xe9;s au cycle de vie du conteneur. Toutefois, bien que cette version ne semble &#xea;tre qu&#x2019;interm&#xe9;diaire, les travaux men&#xe9;s peuvent parfois &#xea;tre d&#xe9;routant pour ceux qui utilisent le scope <b><a class="externalLink" href="http://docs.oracle.com/javaee/7/api/javax/inject/Singleton.html" target="_blank">@javax.inject.Singleton</a></b> &#xe0; ne pas confondre avec l&#x2019;annotation <b><a class="externalLink" href="http://docs.oracle.com/javaee/7/api/javax/ejb/Singleton.html" target="_blank">@javax.ejb.Singleton</a></b> propre &#xe0; la sp&#xe9;cification <b>EJB</b> 3.1 et +</p>
<p>Et c&#x2019;est l&#xe0; justement que les choses peuvent <i>d&#xe9;ranger</i> car dor&#xe9;navant, la sp&#xe9;cification <b>CDI 1.2</b>, lorsqu&#x2019;elle adresse des questions li&#xe9;s &#xe0; des beans <b>@Singleton</b>, il n&#x2019;est question exclusivement que des beans <b>Singletons EJB</b> !</p>
<p>Ok ! Peut-&#xea;tre que la strat&#xe9;gie &#xe0; long terme est de ne disposer que d&#x2019;une seule annotation <b>@Singleton</b> plut&#xf4;t que d&#x2019;avoir deux annotations, la premi&#xe8;re dans le package <b>javax.inject</b> et la deuxi&#xe8;me dans <b>javax.ejb</b>.</p></div>
<div class="section">
<h2>Le Singleton : mal aim&#xe9; du monde Java SE ?<a name="Le_Singleton_:_mal_aim_du_monde_Java_SE_"></a></h2>
<p>La question est volontairement un peu provocatrice mais le probl&#xe8;me constat&#xe9; est que dor&#xe9;navant, tous les beans annot&#xe9;s avec l&#x2019;annotation <b>@javax.inject.Singleton</b> ne sont plus syst&#xe8;matiquement charg&#xe9;s par <b>CDI</b> d&#xe8;s lors que le fichier <b>&#x201c;beans.xml&#x201d;</b> est pr&#xe9;sent et que le mode <b>&#x201c;bean-discovery-mode&#x201d;</b> est positionn&#xe9; &#xe0; <b>&#x201c;annotated&#x201d;</b> :</p>

<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_2.xsd&quot;
       version=&quot;1.2&quot; bean-discovery-mode=&quot;annotated&quot; /&gt;
</pre></div>
<p>Dans ce cas, vous avez le droit &#xe0; l&#x2019;exception Java suivante :</p>

<div class="source">
<pre>java.lang.IllegalStateException: Could not find beans for Type=class eu.sydisnet.blog.samples.deltaspike.cdi12.boundary.SingletonHelloService and qualifiers:[]
    at org.apache.deltaspike.core.api.provider.BeanProvider.getContextualReference(BeanProvider.java:150)
    at org.apache.deltaspike.core.api.provider.BeanProvider.getContextualReference(BeanProvider.java:119)
    at eu.sydisnet.blog.samples.deltaspike.cdi12.boundary.HelloServiceTest.stacktrace_when_singleton(HelloServiceTest.java:115)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:483)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
    at org.junit.internal.runners.statements.ExpectException.evaluate(ExpectException.java:19)
    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
    at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:160)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:74)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:211)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:67)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:483)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:134)
</pre></div>
<p>En revanche, pas de probl&#xe8;me si la valeur <b>&#x201c;all&#x201d;</b> est positionn&#xe9;e &#xe0; la place de <b>&#x201c;annotated&#x201d;</b>.</p></div>
<div class="section">
<h2>Moins de probl&#xe8;mes de SCAN<a name="Moins_de_problmes_de_SCAN"></a></h2>
<p>Pas &#xe9;vident d&#x2019;expliquer la raison d&#x2019;&#xea;tre de ce (dis)fonctionnement mais avant de rentrer dans le d&#xe9;tail, l&#x2019;int&#xe9;r&#xea;t du mode <b>&#x201c;annotated&#x201d;</b> et que seuls les beans annot&#xe9;s sont scann&#xe9;s par <b>CDI</b> au d&#xe9;marrage du conteneur et cela permet d&#x2019;&#xe9;viter des probl&#xe8;mes &#xe9;vidents de <i><b>class-loaders</b></i>.</p>
<p>Cela facilite pas mal de choses quand vous utilisez le plugin <b><a class="externalLink" href="http://maven.apache.org/plugins/maven-shade-plugin/usage.html" target="_blank">Maven Shade</a></b> qui consiste &#xe0; cr&#xe9;er une archive unique contenant toutes les classes du projet mais aussi toutes les classes de toutes les d&#xe9;pendances Maven associ&#xe9;es.</p>
<p>J&#x2019;ai eu l&#x2019;occasion de travailler sur un projet utilisant <b>CDI 1.1</b> avec les drivers <b>JDBC Oracle</b>, <b>Bean Validation</b> (Hibernate Validator) et le pool de connexions <b>HikariCP</b>.</p>
<p>Avec <b>CDI 1.1</b>, il fallait configurer le fichier <b>META-INF/beans.xml</b> comme suit :</p>

<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd&quot;
       version=&quot;1.1&quot; bean-discovery-mode=&quot;annotated&quot;&gt;

    &lt;!-- Configure JAR Scanning Exceptions from CDI --&gt;
    &lt;scan&gt;
        &lt;!-- HikariCP --&gt;
        &lt;exclude name=&quot;com.zaxxer.hikari.hibernate.**&quot;/&gt;--&gt;
        &lt;exclude name=&quot;com.zaxxer.hikari.metrics.**&quot;/&gt;--&gt;
        &lt;!-- JavAssist --&gt;
        &lt;exclude name=&quot;javassist.**&quot;/&gt;
        &lt;!-- Oracle --&gt;
        &lt;exclude name=&quot;oracle.xdb.**&quot;/&gt;
        &lt;exclude name=&quot;oracle.sql.**&quot;/&gt;
        &lt;exclude name=&quot;oracle.jdbc.**&quot;/&gt;
        &lt;!-- Hibernate Validator --&gt;
        &lt;exclude name=&quot;org.hibernate.validator.internal.constraintvalidators.**&quot;/&gt;
        &lt;exclude name=&quot;org.hibernate.validator.parameternameprovider.**&quot;/&gt;
        &lt;!-- JBoss Logging --&gt;
        &lt;exclude name=&quot;org.jboss.logging.**&quot;/&gt;
        &lt;!-- JBoss Weld Extensions --&gt;
        &lt;exclude name=&quot;org.jboss.weld.**&quot;/&gt;
    &lt;/scan&gt;

&lt;/beans&gt;
</pre></div>
<p>Avec <b>CDI 1.2</b>, plus besoin de pr&#xe9;ciser la balise SCAN !</p>

<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_2.xsd&quot;
       version=&quot;1.2 bean-discovery-mode=&quot;annotated&quot;&gt;

    &lt;!-- No need to configure scan with HikariCP, Oracle and so on... --&gt;
&lt;/beans&gt;
</pre></div>
<p>Et &#xe7;a, c&#x2019;est tant mieux !</p></div>
<div class="section">
<h2>Une explication possible ?<a name="Une_explication_possible_"></a></h2>
<p>Alors, une possibilit&#xe9; de r&#xe9;ponse est dans la sp&#xe9;cification. La version 1.2 pr&#xe9;cise quels sont les beans charg&#xe9;s lorsque le mode <b>&#x201c;annotated&#x201d;</b> est actif :</p>

<ul>
  
<li>Les beans qui sont annot&#xe9;s par des annotations ayant un scope de type <i><b>&#x201c;NORMAL&#x201d;</b></i> (i.e. <b>@javax.enterprise.context.NormalScope</b>). Il en existe quatre sp&#xe9;cifiquement fournis par CDI :
  
<ul>
    
<li><b>@javax.enterprise.context.RequestScoped</b> : Valable le temps d&#x2019;une requ&#xea;te HTTP ;</li>
    
<li><b>@javax.enterprise.context.SessionScoped</b> : Valable le temps d&#x2019;une session HTTP ;</li>
    
<li><b>@javax.enterprise.context.ApplicationScoped</b> : Valable le temps d&#x2019;une application ;</li>
    
<li><b>@javax.enterprise.context.ConversationScoped</b> : Valable le temps d&#x2019;une conversation ;</li>
  </ul></li>
  
<li>Les beans qui sont annot&#xe9;s par l&#x2019;annotation <b>javax.enterprise.context.Dependent</b> ;</li>
</ul>
<p>La particularit&#xe9; de cette derni&#xe8;re annotation est qu&#x2019;il s&#x2019;agit l&#xe0; d&#x2019;un scope qui est d&#x2019;un type qui n&#x2019;est pas le type <i><b>&#x201c;NORMAL&#x201d;</b></i> car elle n&#x2019;h&#xe9;rite pas de <i><b>@javax.enterprise.context.NormalScope</b></i>. </p>
<p>En effet, <b>@Dependent</b> h&#xe9;rite d&#x2019;un autre type de scope qui est <b>@javax.inject.Scope</b>. On parle dans ce cas de <b>Pseudo-Scope</b> ! Vous &#xea;tes perdus ?</p>
<p>Bref, pour r&#xe9;sumer, les <b>&#x201c;Pseudo-Scopes&#x201d;</b> concernent des annotations qui h&#xe9;ritent de <b>@javax.inject.Scope</b> et les <b>&#x201c;Normal-Scopes&#x201d;</b> sont des annotations qui h&#xe9;ritent de <b>@javax.enterprise.context.NormalScope</b>.</p>
<p>Or, pour rappel, le package <b>javax.inject</b> ne provient pas de <b>CDI</b> mais de la <b>JSR 330</b>, la sp&#xe9;cification qui a d&#xe9;fini <i><b>&#x201c;@javax.inject.Inject&#x201d;</b></i> !</p>
<p>L&#x2019;annotation <b>@Dependent</b> est rang&#xe9;e dans le package <b>javax.enterprise.content</b> ce qui en fait une annotation d&#xe9;finie par la sp&#xe9;cification <b>CDI</b> construite sur la base de n&#x2019;annotation <b>@javax.inject.Scope</b> rang&#xe9;e dans le package <b>javax.inject</b> d&#xe9;finie par la <b>JSR 330</b>.</p>
<p>Et la raison pour laquelle &#xe7;a ne marche pas pour l&#x2019;annotation <b>@Singleton</b> vient du fait que cette annotation n&#x2019;a pas &#xe9;t&#xe9; d&#xe9;finie par <b>CDI</b> mais par la <b>JSR 330</b> puisqu&#x2019;elle est rang&#xe9;e dans le package <b>javax.inject</b> !</p>
<p>Bon, tout &#xe7;a, c&#x2019;est pas tr&#xe8;s sympa pour tout ceux qui veulent un truc qui marche mais une solution existe&#x2026;</p></div>
<div class="section">
<h2>La solution !<a name="La_solution_"></a></h2>
<p>La sp&#xe9;cification <b>CDI 1.2</b> pr&#xe9;cise donc que les beans qui ne sont pas des <b>&#x201c;Normal Scopes&#x201d;</b>, exception faite de <b>@Dependent</b>, ne sont pas charg&#xe9;s par le conteneur CDI, et cela pour des raisons de compatibilit&#xe9;, je cite :</p>

<blockquote>
<p>Note that to ensure compatibility with other JSR-330 implementations, all pseudo-scope annotations except @Dependent are not bean defining annotations. However, a stereotype annotation including a pseudo-scope annotation is a bean defining annotation.</p>
</blockquote>
<p>Ah ah ! Il suffit donc de cr&#xe9;er sa propre sous-annotation an l&#x2019;annotant avec <b>&#x201c;@javax.enterprise.inject.Stereotype&#x201d;</b> !</p>
<p>Ok, et comment faire un st&#xe9;r&#xe9;otype qui soit un <b>Singleton</b> ? Et bien un faisant une annotation qui h&#xe9;rite de <b>@javax.inject.Singleton</b> pardi !</p>
<p>Voici le r&#xe9;sultat final :</p>

<div class="source">
<pre>@javax.inject.Singleton
@javax.enterprise.inject.Stereotype
@Retention(RetentionPolicy.RUNTIME)
@java.lang.annotation.Target({ElementType.TYPE, ElementType.METHOD })
public @interface Unique {
}
</pre></div>
<p>Cette annotation <i>custom</i> <b>&#x201c;@Unique&#x201d;</b> est &#xe0; utiliser en lieu et place de l&#x2019;annotation <b>&#x201c;@javax.inject.Singleton&#x201d;</b> et l&#xe0;, tout fonctionnera &#xe0; nouveau&#x2026;</p>
<p>Ouf !!! Mais pourquoi tant de haine me direz-vous ! Bref, ce probl&#xe8;me m&#x2019;aura valu quelques heures avant de tout comprendre mais j&#x2019;esp&#xe8;re que cela aidera ceux qui se retrouveront confront&#xe9;s &#xe0; ce probl&#xe8;me et que tout cela sera &#xe9;clairci d&#x2019;ici <b>CDI 2.0</b> :)</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://sydisnet.eu/">SYDISNET</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
